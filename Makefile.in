CC       = @CC@
AR       = @AR@
ARFLAGS  = 
RANLIB   = @RANLIB@
INCS     = 
LIBS     = -lc
#PRJFLAGS = -Wall $(INCS) -ggdb
RM       = @RM@
LD       = @LD@
MAKE     = make

DIRS = libmensa
BIN = mensa
OBJS = main.o defaults.o commands.o mensa-output.o
LIBS = -lmensa
CFLAGS = @CFLAGS@ @DEFS@
LDFLAGS = @LDFLAGS@ @LIBS@

all: mensa libmensa.a

$(BIN): $(OBJS) libmensa.a
	$(CC) $(CFLAGS) $(LDFLAGS) -o mensa $(OBJS) $(LIBS)

main.o: main.c defaults.h commands.h
	$(CC) $(CFLAGS) -c -o main.o main.c

defaults.o: defaults.c defaults.h
	$(CC) $(CFLAGS) -c -o defaults.o defaults.c

commands.o: commands.c commands.h defaults.h
	$(CC) $(CFLAGS) -c -o commands.o commands.c
	
mensa-output.o: mensa-output.c mensa-output.h
	$(CC) $(CFLAGS) -c -o mensa-output.o mensa-output.c
	
#libmensa.so: mensa.o
#	$(CC) $(CFLAGS) -shared -o libmensa.so mensa.o
libmensa.a: force_look
	cd libmensa; $(MAKE) $(MFLAGS)

clean:
	$(RM) -f $(BIN) $(OBJS)
	for d in $(DIRS); do (cd $$d; $(MAKE) clean ); done

force_look:
	true